# WeSense Platform Configuration
# Copy this file to .env and fill in your values
# .env is gitignored and will not be committed

# ===========================================
# Deployment Persona
# ===========================================
# Which services to run on this host. Options:
#   contributor - Ingesters only (sends decoded data to remote MQTT hub)
#   station     - Full local stack (EMQX + ClickHouse + Ingesters + Respiro)
#   hub         - MQTT broker only (production mqtt.wesense.earth)
#   observer    - Map + ClickHouse (future, needs P2P data feed)
#   researcher  - ClickHouse + IPFS (future)
#   guardian    - IPFS pinning (future)
#
# Multiple profiles can be combined:
#   docker compose --profile contributor --profile observer up -d
#
# See Deployment_Personas.md for full details
# Use: docker compose --profile $COMPOSE_PROFILES up -d
COMPOSE_PROFILES=station

# ===========================================
# Timezone
# ===========================================
TZ=Pacific/Auckland

# ===========================================
# Host Port Mapping
# ===========================================
# Ports exposed from containers to the host machine.
# Comment out any port to prevent it being exposed to the host.
# Services still communicate internally via Docker network regardless.

# MQTT (for sensors and devices to connect)
PORT_MQTT=1883

# EMQX dashboard (admin UI — consider localhost-only or disabling in production)
#PORT_DASHBOARD=18083

# Respiro map (typically behind a reverse proxy that handles TLS/letsencrypt)
PORT_RESPIRO=3000

# ClickHouse (not needed unless external tools require direct access)
#PORT_CLICKHOUSE_HTTP=8123
#PORT_CLICKHOUSE_NATIVE=9000

# WebSocket (browser-based MQTT clients — uncomment if needed)
#PORT_WS=8083

# TTN webhook (uncomment if receiving The Things Network uplinks directly;
# not needed if using a cloudflared tunnel or similar)
#PORT_TTN_WEBHOOK=5000

# ===========================================
# TLS Configuration
# ===========================================
# TLS for MQTT and WebSocket listeners (requires certificates in ./certs/)
# If using a reverse proxy (e.g., SWAG, Caddy, Nginx Proxy Manager) for
# Respiro/web traffic, you may only need TLS on the MQTT listener since
# the reverse proxy handles HTTPS termination for HTTP services.
TLS_MQTT_ENABLED=false
# WSS — secure WebSocket for browser-based MQTT clients
TLS_WS_ENABLED=false

# Certificate paths (inside container)
TLS_CERTFILE=/opt/emqx/etc/certs/fullchain.pem
TLS_KEYFILE=/opt/emqx/etc/certs/privkey.pem

# TLS port (only exposed when TLS_MQTT_ENABLED=true)
PORT_MQTT_TLS=8883
# Secure WebSocket port (only exposed when TLS_WS_ENABLED=true)
#PORT_WS_TLS=8084

# ===========================================
# MQTT Broker (EMQX)
# ===========================================
# For station: 'emqx' (Docker container name, default)
# For contributor: set to your remote hub (e.g., mqtt.wesense.earth)
MQTT_HOST=emqx
MQTT_PORT=1883
MQTT_USER=
MQTT_PASSWORD=CHANGEME

# ===========================================
# ClickHouse Configuration
# ===========================================
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_DB=wesense
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=CHANGEME

# Ingester batching
CLICKHOUSE_BATCH_SIZE=100
CLICKHOUSE_FLUSH_INTERVAL=10

# ===========================================
# Meshtastic Ingester
# ===========================================
# Mode: 'community' (local node, default) or 'public' (hub operators only)
# Community: receives from a local Meshtastic node pushing to EMQX
# Public: subscribes to mqtt.meshtastic.org (only run by 1-2 hub operators)
MESHTASTIC_MODE=community

# ===========================================
# WeSense Ingester
# ===========================================
# TTN webhook support (optional HTTP receiver for The Things Network)
TTN_WEBHOOK_ENABLED=false

# ===========================================
# Home Assistant Ingester
# ===========================================
# Connection to Home Assistant instance
HA_URL=http://homeassistant.local:8123
HA_ACCESS_TOKEN=CHANGEME
# Friendly name prefix for device IDs (e.g., "livingroom")
HA_NODE_NAME=
# Set to true to skip ClickHouse writes (MQTT-only mode)
DISABLE_CLICKHOUSE=false

# ===========================================
# General Ingester Configuration
# ===========================================
# For 'contributor' persona connecting to remote hub:
# Override MQTT_HOST above, or set these output vars:
# WESENSE_OUTPUT_BROKER=mqtt.wesense.earth
# WESENSE_OUTPUT_PORT=8883

# Logging
DEBUG=false
LOG_LEVEL=INFO

# ===========================================
# Respiro Map Configuration
# ===========================================
# Override map centre (auto-detects from sensor data by default)
#MAP_CENTER_LAT=-36.848
#MAP_CENTER_LNG=174.763
#MAP_ZOOM_LEVEL=10

# ===========================================
# Container Images
# ===========================================
# Images are automatically built and pushed to GitHub Container Registry
# Override to use local builds or specific versions
INGESTER_MESHTASTIC_IMAGE=ghcr.io/wesense-earth/wesense-ingester-meshtastic:latest
INGESTER_WESENSE_IMAGE=ghcr.io/wesense-earth/wesense-ingester-wesense:latest
INGESTER_HA_IMAGE=ghcr.io/wesense-earth/wesense-ingester-homeassistant:latest
RESPIRO_IMAGE=ghcr.io/wesense-earth/wesense-respiro:latest
